(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[13],{341:function(e,n){},343:function(e,n){},352:function(e,n,t){},353:function(e,n,t){},397:function(e,n,t){"use strict";t.r(n);var r=t(14),c=t(17),i=t(0),s=t(336),a=t.n(s),u=t(12),o=t(135),l=t.n(o),d=t(134),j=t.n(d),f=t(355),b=t.n(f),p=t(354),O=t.n(p),v=t(82),g=t(21),h=(t(352),t(5)),m=function(e){var n=e.peer,t=Object(i.useRef)();return Object(i.useEffect)((function(){n.peer.on("stream",(function(e){t.current.srcObject=e}))}),[]),Object(h.jsxs)("div",{className:"peer-container",children:[Object(h.jsx)("span",{children:n.peer._id}),Object(h.jsx)("video",{playsInline:!0,autoPlay:!0,ref:t})]})};t(353),n.default=function(){var e=Object(i.useContext)(v.a),n=e.socket,t=e.setIncommingCall,s=Object(i.useContext)(g.a).user,o=Object(i.useState)([]),d=Object(c.a)(o,2),f=d[0],p=d[1],x=Object(i.useState)(!0),I=Object(c.a)(x,2),k=I[0],D=I[1],C=Object(i.useState)(!0),w=Object(c.a)(C,2),y=w[0],N=w[1],E=Object(i.useRef)(),S=Object(i.useRef)([]),R=Object(u.g)().id;Object(i.useEffect)((function(){t(null),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){var t=e.getAudioTracks()[0];D(t),t.enabled=!1,E.current.srcObject=e,n.current.emit("join call",R,s),n.current.on("all users",(function(t){var r=[];t.forEach((function(t){var c=T(t.socketId,n.current.id,e,t.username);S.current.push({peerID:t.socketId,peer:c}),r.push({socketId:t.socketId,peer:c})})),p(r)})),n.current.on("user joined",(function(n){var t=_(n.signal,n.callerID,e,n.username);console.log("add peer - before set state peers",t),S.current.push({peerID:n.callerID,peer:t}),p((function(e){return[].concat(Object(r.a)(e),[{socketId:n.callerID,peer:t}])}))})),n.current.on("receiving returned signal",(function(e){var n=S.current.find((function(n){return n.peerID===e.id}));n&&n.peer.signal(e.signal)}))})).catch((function(e){return console.log(e)})),n.current.on("user left",(function(e){p((function(n){return n.filter((function(n){return n.socketId!==e}))}));var n=S.current.find((function(n){return n.peerID===e}));n&&n.peer.destroy();var t=S.current.filter((function(n){return n.peerID!==e}));S.current=t,setTimeout((function(){return console.log(S.current)}),2e3)}))}),[,]);var T=function(e,t,r,c){var i=new a.a({initiator:!0,trickle:!1,stream:r,username:c});return i.on("signal",(function(r){n.current.emit("sending signal",{userToSignal:e,callerID:t,signal:r,username:c})})),i},_=function(e,t,r,c){var i=new a.a({initiator:!1,trickle:!1,stream:r,username:c});return i.on("signal",(function(e){n.current.emit("returning signal",{signal:e,callerID:t})})),i.signal(e),i};return Object(h.jsxs)("div",{className:"video-container",children:[Object(h.jsx)("div",{className:"video-peers",children:f.length>0?f.map((function(e){return Object(h.jsx)(m,{peer:e},e.peer._id)})):Object(h.jsx)("span",{children:"You are alone ;_;"})}),Object(h.jsxs)("div",{className:"video-bar",children:[Object(h.jsx)("video",{ref:E,autoPlay:!0,playsInline:!0,className:"user-video"}),Object(h.jsxs)("div",{onClick:function(){n.current.emit("leave call",s.id),window.close()},children:[Object(h.jsx)(l.a,{}),Object(h.jsx)("span",{children:"End call"})]}),Object(h.jsxs)("div",{onClick:function(){return n.current.emit("call users",R,s.id)},children:[Object(h.jsx)(j.a,{}),Object(h.jsx)("span",{children:"Call all users"})]}),Object(h.jsxs)("div",{onClick:function(){k.enabled=!k.enabled,N(!k.enabled)},children:[y?Object(h.jsx)(O.a,{}):Object(h.jsx)(b.a,{}),Object(h.jsxs)("span",{children:["Microphone ",y?"off":"on"]})]})]})]})}}}]);
//# sourceMappingURL=13.a8e3fe22.chunk.js.map