(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{136:function(e,t,n){},232:function(e,t,n){},237:function(e,t,n){},288:function(e,t,n){},290:function(e,t,n){},291:function(e,t,n){},292:function(e,t,n){},294:function(e,t,n){},295:function(e,t,n){},296:function(e,t,n){},297:function(e,t,n){},298:function(e,t,n){},299:function(e,t,n){},300:function(e,t,n){},301:function(e,t,n){},302:function(e,t,n){},307:function(e,t){},309:function(e,t){},318:function(e,t,n){},319:function(e,t,n){},320:function(e,t,n){},321:function(e,t,n){},323:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(18),a=n.n(c),s=(n(232),n(377)),i=n(31),o=n(375),l=n(21),u=n(90),d=n(45),j=n(46),b=n(32),p=(n(237),n(1)),O=function(e){var t=e.children;return Object(p.jsxs)("div",{children:[Object(p.jsx)("nav",{children:Object(p.jsxs)("ul",{children:[Object(p.jsx)("li",{children:Object(p.jsx)(b.b,{to:"/groups",children:Object(p.jsx)(d.a,{icon:j.c})})}),Object(p.jsx)("li",{children:Object(p.jsx)(b.b,{to:"/calendar",children:Object(p.jsx)(d.a,{icon:j.a})})}),Object(p.jsx)("li",{children:Object(p.jsx)(b.b,{to:"/files",children:Object(p.jsx)(d.a,{icon:j.d})})}),Object(p.jsx)("li",{children:Object(p.jsx)(b.b,{to:"/account",children:Object(p.jsx)(d.a,{icon:j.b})})})]})}),Object(p.jsx)("main",{children:t})]})},f=function(){return Object(p.jsx)(O,{children:Object(p.jsx)("h1",{children:"Home"})})},h=n(113),v=n(202),m=n(204),x=n(12),g=n(6),y=n(69),C=n.n(y),S=Object(r.createContext)(),w=function(e){var t=e.children,n=Object(r.useState)("light"),c=Object(g.a)(n,2),a=c[0],s=c[1],i=Object(r.useState)(null),o=Object(g.a)(i,2),l=o[0],u=o[1],d=C()("http://localhost:4001");return Object(r.useEffect)((function(){var e=localStorage.getItem("theme");e&&s(e)}),[,]),Object(p.jsx)(S.Provider,{value:{theme:a,setTheme:function(e){localStorage.setItem("theme",e),s(e)},user:l,setUser:u,socket:d,url:"http://localhost:4000"},children:t})},k=n(24),N=n(382),T=n(372),I=n(373),E=n(374),_=n(83),D=n(61),P=n(379),M=n(152),W=function(e){var t=e.list,n=e.name,r=e.optionTitle,c=e.label,a=e.errors,s=e.validatorRef,i=e.control,o=e.setValue;return Object(p.jsx)(p.Fragment,{children:Object(p.jsx)(k.a,{name:n,control:i,render:function(e){return Object(p.jsx)(P.a,{multiple:!0,options:t,defaultValue:e.value,getOptionSelected:function(e,t){return e._id===t._id},getOptionLabel:function(e){return e[r]},onChange:function(e,t){var r=t.map((function(e){return!e.id&&e._id&&(e.id=e._id),!e._id&&e.id&&(e._id=e.id),e}));o(n,r)},filterSelectedOptions:!0,fullWidth:!0,value:e.value,renderInput:function(e){var t;return Object(p.jsx)(M.a,Object(D.a)(Object(D.a)({},e),{},{variant:"outlined",label:c,inputRef:s,error:!!a[n],helperText:null===(t=a[n])||void 0===t?void 0:t.message}))}})}})})},R=n(11),G=n.n(R),L=n(19),q=n(104),V=n.n(q),A=function(e){var t=new Blob([e],{type:e.type});if("function"===typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(e,"file");else{var n=t,r=document.createElement("a");r.href=window.URL.createObjectURL(n),r.download="file",document.body.appendChild(r),r.click()}},U="https://vps.franciszekpawlak.pl:17200",F="https://vps.franciszekpawlak.pl:17300",z="https://vps.franciszekpawlak.pl:17400",B=function(){var e=Object(L.a)(G.a.mark((function e(t,n,r,c){var a,s,o,l=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>4&&void 0!==l[4]?l[4]:{"Content-Type":"application/json"},e.prev=1,e.next=4,V()({method:n,url:"".concat(U).concat(t),headers:a,data:c,withCredentials:!0});case 4:(s=e.sent).data?r(s.data):i.b.error("Invalid data"),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0),i.b.error(null===e.t0||void 0===e.t0||null===(o=e.t0.response)||void 0===o?void 0:o.statusText);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,n,r,c){return e.apply(this,arguments)}}(),Z=function(){var e=Object(L.a)(G.a.mark((function e(t){var n,r,c,a=arguments;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:"GET",r=a.length>2&&void 0!==a[2]?a[2]:null,e.next=4,V()({method:n,url:"".concat(U).concat(t),headers:{"Content-Type":"application/json"},data:r,withCredentials:!0});case 4:return c=e.sent,e.abrupt("return",c);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(L.a)(G.a.mark((function e(t){var n;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V()({url:"".concat(U).concat(t),headers:{"Content-Type":"application/json"},withCredentials:!0});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=Object(L.a)(G.a.mark((function e(t,n){var r,c;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,V()({url:"".concat(U).concat(t),method:"POST",data:n,withCredentials:!0,responseType:"blob"});case 3:r=e.sent,A(r.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),i.b.error(null===e.t0||void 0===e.t0||null===(c=e.t0.response)||void 0===c?void 0:c.statusText);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),$=n(75),Q=function(e){var t=e.optionTitle,n=e.errors,r=e.list,c=e.label,a=e.name,s=e.rules,i=e.optionValue,o=e.control,l=e.setValue;return Object(p.jsx)(k.a,{name:a,control:o,rules:s,render:function(e){var s;return Object(p.jsxs)(M.a,{label:c,select:!0,variant:"outlined",fullWidth:!0,defaultValue:e.value,value:e.value,error:!!n[a],helperText:null===(s=n[a])||void 0===s?void 0:s.message,onChange:function(e){return l(a,e.target.value)},children:[Object(p.jsx)($.a,{value:"",children:"Empty"},"empty"),r.map((function(e){return Object(p.jsx)($.a,{value:e[i],children:e[t]},e[i])}))]})}})},Y=function(e){var t,n=e.name,r=e.label,c=e.rules,a=e.autoComplete,s=e.errors,i=e.type,o=e.inputLabelProps,l=e.control;return Object(p.jsx)(k.a,{name:n,control:l,rules:c,as:Object(p.jsx)(M.a,{label:r,type:i,variant:"outlined",autoComplete:a,fullWidth:!0,error:!!s[n],helperText:null===(t=s[n])||void 0===t?void 0:t.message,InputLabelProps:o})})},K=(n(136),n(93)),X=Object(r.createContext)(),ee=function(e){var t=e.children,n=Object(r.useState)([]),c=Object(g.a)(n,2),a=c[0],s=c[1],i=Object(r.useState)(!1),o=Object(g.a)(i,2),l=o[0],u=o[1],d=Object(r.useState)(!1),j=Object(g.a)(d,2),b=j[0],O=j[1],f=Object(r.useState)(!1),h=Object(g.a)(f,2),v=h[0],m=h[1],x=Object(r.useState)([]),y=Object(g.a)(x,2),C=y[0],S=y[1],w=Object(r.useState)([]),k=Object(g.a)(w,2),N=k[0],T=k[1],I=Object(r.useState)(null),E=Object(g.a)(I,2),_=E[0],D=E[1];Object(K.a)("/event/list",J,{onSuccess:function(e){return s(e)},refreshInterval:1e4});return Object(r.useEffect)((function(){return B("/users","GET",S),B("/group/getList","GET",T),function(){S([]),T([])}}),[,]),Object(p.jsx)(X.Provider,{value:{events:a,setEvents:s,editOpen:l,setEditOpen:u,createOpen:b,setCreateOpen:O,detailsOpen:v,setDetailsOpen:m,usersList:C,groups:N,selectedEvent:_,setSelectedEvent:D},children:t})},te=n(60),ne={title:"",start:Object(te.a)(Date.now(),"yyyy-MM-dd'T'k:mm"),end:"",description:"",groupId:"",users:[]},re=function(){var e=Object(r.useContext)(X),t=e.setEvents,n=e.createOpen,c=e.setCreateOpen,a=e.groups,s=e.usersList,o=Object(r.useContext)(S).url,l=Object(r.useState)(!1),u=Object(g.a)(l,2),d=u[0],j=u[1],b=Object(k.b)({defaultValues:ne}),O=b.handleSubmit,f=b.errors,h=b.register,v=b.control,m=b.setValue,y=function(e){t((function(t){return[].concat(Object(x.a)(t),[e])})),c(!1),i.b.success("Success")};return Object(p.jsxs)(N.a,{open:n,onClose:function(){c(!1)},fullWidth:!0,children:[Object(p.jsx)(T.a,{id:"form-dialog-title",children:"Create Event"}),Object(p.jsx)(I.a,{children:Object(p.jsxs)("form",{onSubmit:O((function(e){var t=e.title,n=e.description,r=e.start,c=e.end,a=e.groupId,s=e.users;j(!0),B("".concat(o,"/event/create"),"POST",y,{title:t,description:n,start:new Date(r).toISOString(),end:c?new Date(c).toISOString():null,group:a||null,users:s?s.map((function(e){return e.id})):[]}),j(!1)})),children:[Object(p.jsx)(Y,{name:"title",control:v,type:"text",label:"Title",errors:f,rules:{required:"Required",minLength:{value:5,message:"Min length is 5"}}}),Object(p.jsx)(Y,{name:"description",control:v,type:"text",label:"Description",errors:f,rules:{required:!1}}),Object(p.jsx)(Y,{name:"start",control:v,type:"datetime-local",label:"*Begin date",errors:f,rules:{required:"Required"}}),Object(p.jsx)(Y,{name:"end",control:v,type:"datetime-local",label:"End date",errors:f,rules:{required:!1},inputLabelProps:{shrink:!0}}),Object(p.jsx)(Q,{list:a,optionTitle:"name",label:"select group",errors:f,rules:{required:!1},name:"groupId",optionValue:"_id",control:v,setValue:m}),Object(p.jsx)(W,{list:s,optionTitle:"username",label:"select users",placeholder:"select users",errors:f,name:"users",validatorRef:h({required:!1}),control:v,setValue:m}),Object(p.jsxs)(E.a,{children:[Object(p.jsx)(_.a,{onClick:function(){return c(!1)},color:"primary",children:"Close"}),Object(p.jsxs)(_.a,{type:"submit",color:"primary",children:["Create ",d?"...":null]})]})]})})]})},ce=(n(288),n(92)),ae=n.n(ce),se=function(e){var t,n,r,c,a=e.event;return Object(p.jsxs)("div",{className:"event-container",children:[Object(p.jsxs)("div",{children:[Object(p.jsx)("span",{children:"Title"}),a.title&&Object(p.jsx)("span",{children:a.title})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("span",{children:"Description"}),a.description&&Object(p.jsx)("span",{children:null===a||void 0===a?void 0:a.description})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("span",{children:"Begin"}),a.start&&Object(p.jsx)("span",{children:Object(te.a)(new Date(a.start),"kk:mm dd.MM.uu")})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("span",{children:"End"}),a.end&&Object(p.jsx)("span",{children:Object(te.a)(new Date(a.end),"kk:mm dd.MM.uu")})]}),Object(p.jsxs)("div",{className:"group",children:[Object(p.jsx)("span",{children:"Group Video Call"}),a.group&&Object(p.jsx)("span",{children:null===(t=a.group)||void 0===t?void 0:t.name}),(null===(n=a.group)||void 0===n?void 0:n._id)&&Object(p.jsx)("a",{target:"_blank",rel:"noreferrer",href:"/videoCall/".concat(a.group._id),children:Object(p.jsx)(ae.a,{})})]}),Object(p.jsxs)("div",{className:"users",children:[Object(p.jsx)("span",{children:"Users"}),Object(p.jsx)("div",{children:a.users&&(null===(r=a.users)||void 0===r?void 0:r.map((function(e){return Object(p.jsx)("span",{children:null===e||void 0===e?void 0:e.username},null===e||void 0===e?void 0:e._id)})))})]}),Object(p.jsxs)("div",{children:[Object(p.jsx)("span",{children:"Creator"}),a.creator&&Object(p.jsx)("span",{children:null===(c=a.creator)||void 0===c?void 0:c.username})]})]})},ie=function(){var e,t=Object(r.useContext)(X),n=t.setEvents,c=t.setEditOpen,a=t.selectedEvent,s=t.setSelectedEvent,o=t.detailsOpen,l=t.setDetailsOpen,u=Object(r.useContext)(S),d=u.url,j=u.user,b=Object(r.useState)(null),O=Object(g.a)(b,2),f=O[0],h=O[1],v=Object(r.useState)(!1),m=Object(g.a)(v,2),x=m[0],y=m[1];Object(r.useEffect)((function(){a&&C(a)}),[a,o]);var C=function(){var e=Object(L.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B("".concat(d,"/event/get/").concat(t),"GET",h));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=Object(L.a)(G.a.mark((function e(){var t;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((null===f||void 0===f?void 0:f._id)&&(null===j||void 0===j?void 0:j.id)===(null===f||void 0===f||null===(t=f.creator)||void 0===t?void 0:t._id)){e.next=2;break}return e.abrupt("return");case 2:B("".concat(d,"/event/delete/").concat(f._id),"DELETE",k);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){n((function(e){return e.filter((function(e){return e._id!==f._id}))})),s(null),i.b.success("Success"),y(!1),l(!1)};return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)(N.a,{open:o,onClose:function(){return l(!1)},fullWidth:!0,children:[Object(p.jsx)(T.a,{id:"form-dialog-title",children:"Details Event"}),Object(p.jsx)(I.a,{children:f&&Object(p.jsx)(se,{event:f})}),Object(p.jsxs)(E.a,{children:[Object(p.jsx)(_.a,{onClick:function(){return l(!1)},color:"primary",children:"Close"}),(null===j||void 0===j?void 0:j.id)===(null===f||void 0===f||null===(e=f.creator)||void 0===e?void 0:e._id)?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(_.a,{color:"primary",onClick:function(){return c(!0)},children:"Edit"}),Object(p.jsx)(_.a,{color:"primary",onClick:function(){return y(!0)},children:"Delete"})]}):null]})]}),Object(p.jsxs)(N.a,{open:x,onClose:function(){return y(!1)},fullWidth:!0,children:[Object(p.jsx)(T.a,{children:"Are you sure?"}),Object(p.jsxs)(E.a,{children:[Object(p.jsx)(_.a,{color:"primary",onClick:w,children:"Delete"}),Object(p.jsx)(_.a,{color:"primary",onClick:function(){return y(!1)},children:"Cancel"})]})]})]})},oe=function(){var e=Object(r.useContext)(X),t=e.setEvents,n=e.editOpen,c=e.setEditOpen,a=e.setDetailsOpen,s=e.selectedEvent,o=e.setSelectedEvent,l=e.usersList,u=e.groups,d=Object(r.useContext)(S).url,j=Object(r.useState)(!1),b=Object(g.a)(j,2),O=b[0],f=b[1],h=Object(k.b)({defaultValues:ne}),v=h.handleSubmit,m=h.errors,x=h.register,y=h.control,C=h.setValue;Object(r.useEffect)((function(){s&&w(s)}),[s,n]);var w=function(){var e=Object(L.a)(G.a.mark((function e(t){return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",B("".concat(d,"/event/get/").concat(t),"GET",P));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=Object(L.a)(G.a.mark((function e(t){var n,r,c,a,i,o;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.title,r=t.description,c=t.start,a=t.end,i=t.groupId,o=t.users,f(!0),B("".concat(d,"/event/edit"),"POST",M,{id:s,title:n,description:r,start:new Date(c).toISOString(),end:a?new Date(a).toISOString():null,group:i||null,users:o?o.map((function(e){return e._id})):[]}),f(!1);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(e){var t=e.title,n=e.description,r=e.start,c=e.end,a=e.users,s=e.group;C("title",t,{shouldDirty:!0,shouldValidate:!0}),C("description",n),C("start",Object(te.a)(new Date(r),"yyyy-MM-dd'T'k:mm")),C("end",c?Object(te.a)(new Date(c),"yyyy-MM-dd'T'k:mm"):""),C("users",a||[]),C("groupId",s?s._id:"")},M=function(e){t((function(t){return t.map((function(t){return t._id===e._id&&(t=e),t}))})),o(null),c(!1),a(!1),i.b.success("Success")};return Object(p.jsxs)(N.a,{open:n,onClose:function(){c(!1),o(null)},fullWidth:!0,children:[Object(p.jsx)(T.a,{id:"form-dialog-title",children:"Edit Event"}),Object(p.jsx)(I.a,{children:Object(p.jsxs)("form",{onSubmit:v(D),children:[Object(p.jsx)(Y,{name:"title",control:y,type:"text",label:"Title",errors:m,rules:{required:"Required",minLength:{value:5,message:"Min length is 5"}}}),Object(p.jsx)(Y,{name:"description",control:y,type:"text",label:"Description",errors:m,rules:{required:!1}}),Object(p.jsx)(Y,{name:"start",control:y,type:"datetime-local",label:"*Begin date",errors:m,rules:{required:"Required"}}),Object(p.jsx)(Y,{name:"end",control:y,type:"datetime-local",label:"End date",errors:m,rules:{required:!1},inputLabelProps:{shrink:!0}}),Object(p.jsx)(Q,{list:u,optionTitle:"name",label:"select group",errors:m,rules:{required:!1},name:"groupId",optionValue:"_id",control:y,setValue:C}),Object(p.jsx)(W,{list:l,optionTitle:"username",label:"select users",placeholder:"select users",errors:m,name:"users",validatorRef:x({required:!1}),control:y,setValue:C}),Object(p.jsxs)(E.a,{children:[Object(p.jsx)(_.a,{onClick:function(){c(!1),o(null)},color:"primary",children:"Close"}),Object(p.jsxs)(_.a,{type:"submit",color:"primary",children:["Edit ",O?"...":null]})]})]})})]})},le=(n(290),function(){var e=Object(r.useContext)(X),t=e.events,n=e.setCreateOpen,c=e.setSelectedEvent,a=e.setDetailsOpen,s=Object(h.useMediaQuery)({minWidth:800}),i={custom:{text:"Add event",click:function(){return n(!0)}}};return Object(p.jsxs)(O,{children:[Object(p.jsx)("div",{id:"calendar",children:Object(p.jsx)(v.a,{plugins:[m.a],displayEventEnd:!0,displayEventTime:!0,eventClick:function(e){c(e.event.extendedProps._id),a(!0)},eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventDisplay:"block",initialView:s?"dayGridMonth":"dayGridDay",height:"90vh",customButtons:i,headerToolbar:{center:"custom",right:"prev,next,today,dayGridDay,dayGridWeek,dayGridMonth"},events:t})}),Object(p.jsx)(re,{}),Object(p.jsx)(ie,{}),Object(p.jsx)(oe,{})]})}),ue=function(){return Object(p.jsx)(ee,{children:Object(p.jsx)(le,{})})},de=n(199),je=[{field:"id",headerName:"Id",hide:!0},{field:"name",headerName:"Name",flex:2},{field:"type",headerName:"Type",flex:1},{field:"uploadDate",headerName:"Upload date",flex:1,valueGetter:function(e){return Object(te.a)(new Date(e.value),"yyyy-MM-dd' 'k:mm")}},{field:"size",headerName:"Size",flex:1,valueGetter:function(e){return(parseInt(e.value)/1024/1024).toFixed(2)+" MB"}}],be=(n(291),function(e){var t=e.open,n=e.setOpen,r=e.fileRef,c=e.upload;return Object(p.jsxs)(N.a,{open:t,onClose:function(){return n(!1)},fullWidth:!0,children:[Object(p.jsx)(T.a,{children:"Upload file"}),Object(p.jsx)(I.a,{children:Object(p.jsx)("input",{className:"upload",ref:r,type:"file"})}),Object(p.jsxs)(E.a,{children:[Object(p.jsx)(_.a,{onClick:function(){return n(!1)},color:"primary",children:"Close"}),Object(p.jsx)(_.a,{type:"submit",color:"primary",onClick:c,children:"Upload"})]})]})}),pe=(n(292),function(){var e=Object(r.useContext)(S).url,t=Object(r.useState)([]),n=Object(g.a)(t,2),c=n[0],a=n[1],s=Object(r.useState)(!1),o=Object(g.a)(s,2),l=o[0],u=o[1],d=Object(r.useState)([]),j=Object(g.a)(d,2),b=j[0],f=j[1],h=Object(r.useRef)(null);Object(K.a)("".concat(e,"/file/list"),J,{onSuccess:function(e){return f(e)},refreshInterval:1e4});var v=function(e){f((function(t){return[].concat(Object(x.a)(t),[e])})),i.b.success("Success"),u(!1)},m=function(e){i.b.success("Success");var t=e.ids?e.ids:c;f((function(e){return e.filter((function(e){return!t.includes(e._id)}))})),a([])};return Object(p.jsxs)(O,{children:[Object(p.jsxs)("div",{className:"files-buttons",children:[c.length>0&&Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(_.a,{variant:"contained",color:"primary",onClick:function(){return H("".concat(e,"/file/download"),{ids:c})},children:"Download"}),Object(p.jsx)(_.a,{variant:"contained",color:"primary",onClick:function(){return B("".concat(e,"/file/delete"),"POST",m,{ids:c})},children:"Delete"})]}),Object(p.jsx)(_.a,{onClick:function(){return u(!0)},variant:"contained",color:"primary",children:"Upload"})]}),Object(p.jsx)(de.a,{autoHeight:!0,onSelectionModelChange:function(e){return a(e.selectionModel)},rows:b,columns:je,pageSize:10,checkboxSelection:!0,pagination:!0}),Object(p.jsx)(be,{open:l,setOpen:u,fileRef:h,upload:function(){var t=new FormData;t.append("file",h.current.files[0]),B("".concat(e,"/file/upload"),"POST",v,t,{"Contetnt-Type":"multipart/form-data"})}})]})}),Oe=n(378),fe=n(147),he=n(328),ve=n(329),me=n(105),xe=n(154),ge=n(150),ye=n(380),Ce=function(){var e,t,n,c=Object(k.b)({mode:"all",shouldUnregister:!1}),a=c.handleSubmit,s=c.errors,i=c.register,o=Object(r.useState)(null),l=Object(g.a)(o,2),u=l[0],d=l[1],j=Object(r.useContext)(S).url,b=Object(r.useState)(!1),O=Object(g.a)(b,2),f=O[0],h=O[1],v=Object(r.useState)(2),m=Object(g.a)(v,2),x=m[0],y=m[1],C=function(){var e=Object(L.a)(G.a.mark((function e(t){var n,r,c,a,s,i;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.email,r=t.username,c=t.password,h(!0),e.prev=2,e.next=5,Z("".concat(j,"/register"),"POST",{email:n,username:r,password:c,role:x});case 5:a=e.sent,d({status:"success",text:a.data}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),(null===e.t0||void 0===e.t0||null===(s=e.t0.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.error)?d({status:"error",text:e.t0.response.data.error}):d({status:"error",text:e.t0.message}),console.error(e.t0);case 13:h(!1);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)("form",{onSubmit:a(C),style:{width:"100%"},children:[Object(p.jsx)(Oe.a,{py:2,children:Object(p.jsx)(fe.a,{variant:"h5",component:"h2",children:"Create new account"})}),Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(M.a,{name:"username",label:"username",type:"text",variant:"outlined",defaultValue:"",fullWidth:!0,inputRef:i({required:"Required"}),error:!!s.username,helperText:null===(e=s.username)||void 0===e?void 0:e.message})}),Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(M.a,{name:"email",label:"email",type:"email",variant:"outlined",autoComplete:"email",fullWidth:!0,defaultValue:"",inputRef:i({required:"Required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,message:"invalid email address"}}),error:!!s.email,helperText:null===(t=s.email)||void 0===t?void 0:t.message})}),Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(M.a,{className:"password",name:"password",label:"password",type:"password",variant:"outlined",defaultValue:"",fullWidth:!0,inputRef:i({required:"Required"}),error:!!s.password,helperText:null===(n=s.password)||void 0===n?void 0:n.message})}),Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsxs)(me.a,{fullWidth:!0,variant:"outlined",children:[Object(p.jsx)(xe.a,{htmlFor:"role",children:"Role"}),Object(p.jsxs)(ge.a,{value:x,variant:"outlined",label:"role",name:"role",id:"role",onChange:function(e){return y(e.target.value)},children:[Object(p.jsx)($.a,{value:2,selected:!0,children:"User"}),Object(p.jsx)($.a,{value:1,children:"Menager"}),Object(p.jsx)($.a,{value:0,children:"Admin"})]})]})}),u?Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(ye.a,{className:"alert",severity:u.status,children:u.text})}):null,Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsxs)(_.a,{variant:"contained",color:"primary",type:"submit",value:"add user",fullWidth:!0,children:["create account ",f?"...":null]})})]})},Se=function(){var e,t,n=Object(k.b)({mode:"all",shouldUnregister:!1}),c=n.handleSubmit,a=n.errors,s=n.register,i=Object(r.useContext)(S).url,o=Object(r.useState)(null),l=Object(g.a)(o,2),u=l[0],d=l[1],j=Object(r.useState)(!1),b=Object(g.a)(j,2),O=b[0],f=b[1],h=function(){var e=Object(L.a)(G.a.mark((function e(t){var n,r,c,a,s;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.oldPassword,r=t.newPassword,f(!0),e.prev=2,e.next=5,Z("".concat(i,"/resetPassword"),"POST",{oldPassword:n,newPassword:r});case 5:c=e.sent,d({status:"success",text:c.data}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),(null===e.t0||void 0===e.t0||null===(a=e.t0.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)?d({status:"error",text:e.t0.response.data.error}):d({status:"error",text:e.t0.message}),console.error(e.t0);case 13:f(!1);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)("form",{onSubmit:c(h),style:{width:"100%"},children:[Object(p.jsx)(Oe.a,{py:2,children:Object(p.jsx)(fe.a,{variant:"h5",component:"h2",children:"Reset password"})}),Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(M.a,{name:"oldPassword",label:"old password",type:"password",variant:"outlined",autoComplete:"current-password",defaultValue:"",fullWidth:!0,inputRef:s({required:"Required"}),error:!!a.oldPassword,helperText:null===(e=a.oldPassword)||void 0===e?void 0:e.message})}),Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(M.a,{name:"newPassword",label:"new password",type:"password",variant:"outlined",defaultValue:"",fullWidth:!0,inputRef:s({required:"Required"}),error:!!a.newPassword,helperText:null===(t=a.newPassword)||void 0===t?void 0:t.message})}),u?Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(ye.a,{className:"alert",severity:u.status,children:u.text})}):null,Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsxs)(_.a,{variant:"contained",color:"primary",type:"submit",fullWidth:!0,children:["reset password ",O?"...":null]})})]})},we=function(){var e=Object(l.f)(),t=Object(r.useContext)(S),n=t.setTheme,c=t.theme,a=t.user;return Object(p.jsx)(O,{children:Object(p.jsxs)(Oe.a,{className:"account",display:"flex",flexDirection:"column",alignItems:"center",children:[Object(p.jsx)(Oe.a,{p:2,children:Object(p.jsxs)(fe.a,{variant:"h3",component:"h1",children:["Welcome, ",null===a||void 0===a?void 0:a.username]})}),Object(p.jsxs)(Oe.a,{display:"flex",flexWrap:"wrap",justifyContent:"space-around",alignItems:"start",width:"100%",children:[0!==parseInt(null===a||void 0===a?void 0:a.role)?null:Object(p.jsx)(Oe.a,{p:4,display:"flex",width:"50%",justifyContent:"center",children:Object(p.jsx)(Ce,{})}),Object(p.jsx)(Oe.a,{p:4,display:"flex",width:"50%",justifyContent:"center",children:Object(p.jsx)(Se,{})})]}),Object(p.jsx)(Oe.a,{m:4,children:Object(p.jsx)(he.a,{control:Object(p.jsx)(ve.a,{onChange:function(){return n("light"===c?"dark":"light")},checked:"light"!==c}),label:"Dark theme"})}),Object(p.jsx)(Oe.a,{m:4,children:Object(p.jsxs)(_.a,{variant:"contained",color:"primary",onClick:function(){return e.push("/logout")},children:["LOGOUT",Object(p.jsx)(Oe.a,{ml:2,children:Object(p.jsx)(d.a,{icon:j.g})})]})})]})})},ke=n(80),Ne=(n(294),function(){var e,t,n=Object(k.b)({mode:"all",shouldUnregister:!1}),c=n.handleSubmit,a=n.errors,s=n.control,i=Object(r.useState)(""),o=Object(g.a)(i,2),u=o[0],b=o[1],O=Object(r.useState)(""),f=Object(g.a)(O,2),h=f[0],v=f[1],m=Object(r.useState)(!1),x=Object(g.a)(m,2),y=x[0],C=x[1],w=Object(r.useState)(null),N=Object(g.a)(w,2),T=N[0],I=N[1],E=Object(l.f)(),D=Object(r.useContext)(S),P=D.url,W=D.setUser,R=function(){var e=Object(L.a)(G.a.mark((function e(t){var n,r,c,a,s,i,o,l,u;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.email,r=t.password,C(!0),n&&r){e.next=4;break}return e.abrupt("return",I("Incorrect email or password"));case 4:return e.prev=4,e.next=7,Z("".concat(P,"/login"),"POST",{email:n,password:r});case 7:c=e.sent,a=c.status,s=c.data,200===a&&s.username&&s.role&&(W(s),ke.set("user",JSON.stringify(s),{expires:7}),E.push("/")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),(null===e.t0||void 0===e.t0||null===(i=e.t0.response)||void 0===i||null===(o=i.data)||void 0===o?void 0:o.error)?I(null===e.t0||void 0===e.t0||null===(l=e.t0.response)||void 0===l||null===(u=l.data)||void 0===u?void 0:u.error):I(e.t0.message);case 15:C(!1);case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"login",children:[Object(p.jsx)(fe.a,{className:"icon",variant:"h2",component:"span",children:Object(p.jsx)(d.a,{icon:j.f})}),Object(p.jsx)(fe.a,{className:"title",variant:"h3",component:"h1",children:"Sign In"}),Object(p.jsxs)("form",{onSubmit:c(R),children:[Object(p.jsx)(k.a,{as:M.a,className:"email",name:"email",label:"email",type:"email",variant:"outlined",autoComplete:"email",defaultValue:u,onChange:function(e){return b(e.target.value)},control:s,error:!!a.email,helperText:null===(e=a.email)||void 0===e?void 0:e.message,rules:{required:"Required",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i,message:"invalid email address"}}}),Object(p.jsx)(k.a,{as:M.a,className:"password",name:"password",label:"password",type:"password",variant:"outlined",autoComplete:"current-password",defaultValue:h,onChange:function(e){return v(e.target.value)},control:s,error:!!a.password,helperText:null===(t=a.password)||void 0===t?void 0:t.message,rules:{required:"Required"}}),T?Object(p.jsx)(ye.a,{className:"alert",severity:"success",color:"error",children:T}):null,Object(p.jsxs)(_.a,{variant:"contained",color:"primary",type:"submit",value:"login",children:["Login ",y?"...":null]})]})]})}),Te=(n(295),function(){var e=Object(l.f)(),t=Object(r.useContext)(S),n=t.url,c=t.setUser;return Object(r.useEffect)((function(){Z("".concat(n,"/logout"),"GET"),c(null),ke.remove("user"),e.push("/login")}),[,]),Object(p.jsx)("div",{className:"logout",children:Object(p.jsx)(d.a,{icon:j.e})})}),Ie=Object(r.createContext)(),Ee=function(e){var t=e.children,n=Object(r.useState)(!1),c=Object(g.a)(n,2),a=c[0],s=c[1],i=Object(r.useState)(null),o=Object(g.a)(i,2),l=o[0],u=o[1],d=Object(r.useState)(null),j=Object(g.a)(d,2),b=j[0],O=j[1],f=Object(r.useState)(!0),h=Object(g.a)(f,2),v=h[0],m=h[1];return Object(p.jsx)(Ie.Provider,{value:{open:a,setOpen:s,groupMobile:l,setGroupMobile:u,groupDesktop:b,setGroupDesktop:O,desktopInitScroll:v,setDesktopInitScroll:m},children:t})},_e=n(376),De=Object(r.createContext)(),Pe=function(e){var t=e.children,n=Object(r.useState)([]),c=Object(g.a)(n,2),a=c[0],s=c[1],i=Object(r.useState)(""),o=Object(g.a)(i,2),l=o[0],u=o[1],d=Object(r.useState)(!1),j=Object(g.a)(d,2),b=j[0],O=j[1],f=Object(K.a)("/group/getListWithNotification",J,{onSuccess:function(e){return b?null:s(e)},refreshInterval:5e3}).data;return Object(p.jsx)(De.Provider,{value:{groupList:a,setGroupList:s,searchGroup:function(e){u(e);var t=f.filter((function(t){return t.group.name.includes(e)}));s(t)},setIsSearching:O,searchingPhrase:l,setSearchingPhrase:u},children:t})},Me=function(){var e=Object(r.useContext)(S).url,t=Object(r.useContext)(Ie),n=t.open,c=t.setOpen,a=t.setGroupMobile,s=t.setGroupDesktop,i=Object(r.useContext)(De),o=i.setGroupList,l=i.groupList,u=Object(r.useState)(null),d=Object(g.a)(u,2),j=d[0],b=d[1],O=Object(r.useState)(null),f=Object(g.a)(O,2),h=f[0],v=f[1],m=Object(r.useState)([]),y=Object(g.a)(m,2),C=y[0],w=y[1];Object(r.useEffect)((function(){return W(),b([])}),[,]);var k=function(){var t=Object(L.a)(G.a.mark((function t(){var n;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null===j||void 0===j?void 0:j.map((function(e){return e.id}))){t.next=3;break}return t.abrupt("return");case 3:B("".concat(e,"/group/create"),"POST",R,{users:n,name:h});case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),W=function(){return B("".concat(e,"/users"),"GET",w)},R=function(e){o([{group:e,notSeenMessages:0}].concat(Object(x.a)(l))),s(e),a(e),c(!1)};return Object(p.jsxs)(N.a,{open:n,onClose:function(){return c(!1)},fullWidth:!0,children:[Object(p.jsx)(T.a,{id:"form-dialog-title",children:"Create Group"}),Object(p.jsxs)(I.a,{children:[Object(p.jsx)(_e.a,{children:"Select group users."}),Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(P.a,{multiple:!0,options:C,getOptionLabel:function(e){return e.username},filterSelectedOptions:!0,fullWidth:!0,onChange:function(e,t){return b(t)},renderInput:function(e){return Object(p.jsx)(M.a,Object(D.a)(Object(D.a)({},e),{},{variant:"outlined",label:"select users",placeholder:"select users"}))}})}),Object(p.jsx)(Oe.a,{py:1,children:Object(p.jsx)(M.a,{name:"group name",label:"group name",type:"text",variant:"outlined",defaultValue:"",fullWidth:!0,onChange:function(e){return v(e.target.value)}})})]}),Object(p.jsxs)(E.a,{children:[Object(p.jsx)(_.a,{onClick:function(){return c(!1)},color:"primary",children:"Cancel"}),Object(p.jsx)(_.a,{onClick:k,color:"primary",children:"Create"})]})]})},We=n(148),Re=n(384),Ge=n(120),Le=n.n(Ge),qe=n(95),Ve=n.n(qe),Ae=(n(296),function(){var e=Object(r.useContext)(Ie),t=e.groupDesktop,n=e.setGroupDesktop,c=e.setOpen,a=e.setDesktopInitScroll,s=Object(r.useContext)(De),i=s.groupList,o=s.searchGroup,l=s.setIsSearching,u=s.searchingPhrase,d=s.setSearchingPhrase;return Object(r.useEffect)((function(){!t&&(null===i||void 0===i?void 0:i.length)>0&&n(i[0].group)})),Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(M.a,{className:"conversation-search",placeholder:"find conversation",variant:"outlined",fullWidth:!0,size:"small",value:u,onChange:function(e){""===e.target.value?(l(!1),d("")):(l(!0),o(e.target.value))},InputProps:{endAdornment:Object(p.jsx)("span",{children:Object(p.jsx)(Le.a,{className:"conversation-search-icon",color:"primary",fontSize:"small",onClick:function(){return c(!0)}})})}}),Object(p.jsx)("div",{className:"desktop-conversations-container",children:null===i||void 0===i?void 0:i.map((function(e){var r=e.notSeenMessages,c=e.group;return Object(p.jsxs)("div",{className:"".concat((null===t||void 0===t?void 0:t._id)===c._id?"conversation-active":""," conversations-item"),children:[Object(p.jsxs)("div",{className:"conversation-item-text-container",onClick:function(){a(!0),n(c)},children:[r>0?Object(p.jsx)(We.a,{max:99,badgeContent:r,color:"primary",anchorOrigin:{vertical:"top",horizontal:"right"},children:Object(p.jsx)(Re.a,{children:c.users.length>2?Object(p.jsx)(Ve.a,{}):null})}):Object(p.jsx)(Re.a,{children:c.users.length>2?Object(p.jsx)(Ve.a,{}):null}),Object(p.jsx)("span",{className:"conversation-item-text",children:c.name})]}),Object(p.jsx)("a",{className:"conversation-video-link",href:"/videoCall/".concat(c._id),target:"_blank",rel:"noreferrer",children:Object(p.jsx)(ae.a,{})})]},c._id)}))})]})}),Ue=n(149),Fe=n(141),ze=n.n(Fe),Be=(n(297),function(e){var t=e.message,n=e.type,c=Object(r.useContext)(S).user,a=Object(r.useContext)(Ie),s=a.groupMobile,i=a.groupDesktop,o=Object(r.useState)([]),l=Object(g.a)(o,2),u=l[0],d=l[1],j=u.filter((function(e){return t.seen.includes(e._id)&&t.user._id!==e._id})),b=t.seen.filter((function(e){return e!==c.id}));return Object(r.useEffect)((function(){d("mobile"===n?s.users:i.users)}),[,]),Object(p.jsxs)("span",{className:"".concat(t.user._id===c.id?"message-right":"message-left"," message-container"),children:[(null===b||void 0===b?void 0:b.length)>0&&t.user._id===c.id?Object(p.jsx)("span",{className:"message-icons",children:b.map((function(e){return Object(p.jsx)(ze.a,{},e)}))}):null,Object(p.jsx)(Ue.a,{enterTouchDelay:10,placement:t.user._id===c.id?"left":"right",title:Object(p.jsxs)("span",{className:"message-tooltip",children:[Object(p.jsx)("span",{children:new Date(t.createDate).toLocaleString()}),Object(p.jsxs)("span",{children:["From ",t.user.username]}),Object(p.jsxs)("span",{children:["Seen: ",j.map((function(e){return e.username+" "}))]})]}),children:Object(p.jsx)("span",{className:"".concat(t.user._id===c.id?"message-dark":"message-light"," message-text"),children:Object(p.jsx)("span",{children:t.text})})}),(null===b||void 0===b?void 0:b.length)>0&&t.user._id!==c.id?Object(p.jsx)("span",{className:"message-icons",children:b.map((function(e){return Object(p.jsx)(ze.a,{},e)}))}):null]},t._id)}),Ze=n(122),Je=n.n(Ze),He=n(385),$e=n(82),Qe=n(121),Ye=n.n(Qe),Ke=(n(298),function(e){var t=e.type,n=e.message,r=e.closeAction;return Object(p.jsx)(He.a,{open:!0,color:"primary",children:Object(p.jsxs)(ye.a,{severity:t,className:"toast",children:[n,Object(p.jsx)($e.a,{"aria-label":"close",color:"inherit",onClick:r,children:Object(p.jsx)(Ye.a,{})})]}),anchorOrigin:{vertical:"bottom",horizontal:"left"}})}),Xe=(n(299),function(){var e=Object(r.useContext)(S).user,t=Object(r.useContext)(Ie),n=t.groupDesktop,c=t.desktopInitScroll,a=t.setDesktopInitScroll,s=Object(r.useState)(null),i=Object(g.a)(s,2),o=i[0],l=i[1],u=Object(r.useState)(null),d=Object(g.a)(u,2),j=d[0],b=d[1],O=Object(r.useState)([]),f=Object(g.a)(O,2),h=f[0],v=f[1],m=Object(r.useState)(""),y=Object(g.a)(m,2),w=y[0],k=y[1],N=Object(r.useState)([]),T=Object(g.a)(N,2),I=T[0],E=T[1],_=Object(r.useState)(!1),D=Object(g.a)(_,2),P=D[0],W=D[1],R=Object(r.useRef)(null);Object(r.useEffect)((function(){var t=C()(F);return n&&(l(t),t.emit("joinGroup",e.id,n._id),t.on("initMessages",(function(e){"success"===e.status?v(e.data):b(e.data.name)})),t.on("message",(function(e){"success"===e.status?v((function(t){return[].concat(Object(x.a)(t),[e.data])})):b(e.data)})),t.on("typing",(function(e){if("on"===e.status){var t=n.users.find((function(t){return t._id===e.user}));E([].concat(Object(x.a)(I),[t]))}else{var r=I.filter((function(t){return t._id!==e.user}));E(r)}}))),function(){t.emit("leaveGroup")}}),[n]),Object(r.useEffect)((function(){var e;c&&(null===R||void 0===R||null===(e=R.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))})),Object(r.useEffect)((function(){return W(!1)}),[n]);var G=function(e){return o.emit("typing",e)};return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{className:"desktop-messages",onScroll:function(){return a(!1)},children:[(null===h||void 0===h?void 0:h.length)>0?h.map((function(e){return Object(p.jsx)(Be,{message:e,type:"desktop"},e._id)})):null,Object(p.jsx)("div",{ref:R})]}),null===I||void 0===I?void 0:I.map((function(e){return Object(p.jsx)("span",{className:"loading-dots",children:e.username})})),Object(p.jsx)(M.a,{className:"desktop-messages-input",placeholder:"type message..",variant:"outlined",fullWidth:!0,size:"small",multiline:!0,value:w,onBlur:function(){return G("off")},onFocus:function(){P||(o.emit("markMessagesAsSeen"),W(!0)),G("on")},onChange:function(e){return k(e.target.value)},InputProps:{endAdornment:Object(p.jsx)(Je.a,{onClick:function(){""!==w&&(o.emit("message",w,n._id,e.id),k(""))},style:{cursor:"pointer"},fontSize:"small",color:"primary"})}}),j&&Object(p.jsx)(Ke,{type:"error",message:j,closeAction:function(){return b(null)}})]})}),et=(n(300),function(){var e=Object(r.useContext)(Ie).groupDesktop;return Object(p.jsxs)("div",{className:"conversation-desktop",children:[Object(p.jsx)("div",{className:"desktop-conversations",children:Object(p.jsx)(Ae,{})}),Object(p.jsx)("div",{className:"desktop-messages",children:e?Object(p.jsx)(Xe,{}):null})]})}),tt=(n(301),function(){var e=Object(r.useContext)(Ie),t=e.groupMobile,n=e.setGroupMobile,c=e.setOpen,a=Object(r.useContext)(De),s=a.groupList,i=a.searchGroup,o=a.setIsSearching,l=a.searchingPhrase,u=a.setSearchingPhrase;return Object(p.jsxs)("div",{className:"mobile-conversations-container",children:[Object(p.jsx)("div",{className:"mobile-conversations",children:null===s||void 0===s?void 0:s.map((function(e){var r=e.notSeenMessages,c=e.group;return Object(p.jsxs)("div",{className:"".concat((null===t||void 0===t?void 0:t._id)===c._id?"conversation-active":""," conversations-item"),children:[Object(p.jsxs)("div",{className:"conversation-item-text-container",onClick:function(){return n(c)},children:[r>0?Object(p.jsx)(We.a,{max:99,badgeContent:r,color:"primary",anchorOrigin:{vertical:"top",horizontal:"right"},children:Object(p.jsx)(Re.a,{children:c.users.length>2?Object(p.jsx)(Ve.a,{}):null})}):Object(p.jsx)(Re.a,{children:c.users.length>2?Object(p.jsx)(Ve.a,{}):null}),Object(p.jsx)("span",{className:"conversation-item-text",children:c.name})]}),Object(p.jsx)("a",{className:"conversation-video-link",href:"/videoCall/".concat(c._id),target:"_blank",rel:"noreferrer",children:Object(p.jsx)(ae.a,{})})]},c._id)}))}),Object(p.jsx)(M.a,{className:"mobile-conversations-search",placeholder:"find conversation",variant:"outlined",fullWidth:!0,size:"small",value:l,onChange:function(e){""===e.target.value?(o(!1),u("")):(o(!0),i(e.target.value))},InputProps:{endAdornment:Object(p.jsx)("span",{children:Object(p.jsx)(Le.a,{className:"mobile-conversations-search-icon",color:"primary",fontSize:"small",onClick:function(){return c(!0)}})})}})]})}),nt=(n(302),function(){var e=Object(r.useContext)(Ie),t=e.groupMobile,n=e.setGroupMobile,c=Object(r.useContext)(S).user,a=Object(r.useState)(null),s=Object(g.a)(a,2),i=s[0],o=s[1],l=Object(r.useState)(null),u=Object(g.a)(l,2),d=(u[0],u[1]),j=Object(r.useState)([]),b=Object(g.a)(j,2),O=b[0],f=b[1],h=Object(r.useState)(""),v=Object(g.a)(h,2),m=v[0],y=v[1],w=Object(r.useState)([]),k=Object(g.a)(w,2),T=k[0],I=k[1],E=Object(r.useState)(!1),_=Object(g.a)(E,2),D=_[0],P=_[1],W=Object(r.useState)(!0),R=Object(g.a)(W,2),G=R[0],L=R[1],q=Object(r.useRef)(null);Object(r.useEffect)((function(){var e=C()(F);return t&&(o(e),e.emit("joinGroup",c.id,t._id),e.on("initMessages",(function(e){"success"===e.status?f(e.data):d(e.data)})),e.on("message",(function(e){"success"===e.status?(console.log(e),f((function(t){return[].concat(Object(x.a)(t),[e.data])}))):d(e.data.name)})),e.on("typing",(function(e){if("on"===e.status){var n=t.users.find((function(t){return t._id===e.user}));I([].concat(Object(x.a)(T),[n]))}else{var r=T.filter((function(t){return t._id!==e.user}));I(r)}}))),function(){e.emit("leaveGroup")}}),[t]),Object(r.useEffect)((function(){var e;G&&(null===q||void 0===q||null===(e=q.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}));var V=function(e){return i.emit("typing",e)};return Object(p.jsxs)(N.a,{fullScreen:!0,open:!!t,className:"mobile-messages",children:[Object(p.jsxs)("div",{className:"mobile-messages-bar",children:[Object(p.jsx)($e.a,{edge:"start",color:"inherit",onClick:function(){P(!1),n(null),L(!0)},"aria-label":"close",children:Object(p.jsx)(Ye.a,{})}),(null===t||void 0===t?void 0:t.name)&&Object(p.jsx)("span",{children:t.name})]}),Object(p.jsxs)("div",{className:"mobile-messages-content",onScroll:function(){return L(!1)},children:[(null===O||void 0===O?void 0:O.length)>0?O.map((function(e){return Object(p.jsx)(Be,{message:e,type:"mobile"},e._id)})):null,Object(p.jsx)("div",{ref:q})]}),null===T||void 0===T?void 0:T.map((function(e){return Object(p.jsx)("span",{className:"loading-dots",children:e.username})})),Object(p.jsx)(M.a,{className:"mobile-messages-input",placeholder:"type message..",variant:"outlined",size:"small",multiline:!0,value:m,onBlur:function(){return V("off")},onFocus:function(){D||(i.emit("markMessagesAsSeen"),P(!0)),V("on")},onChange:function(e){return y(e.target.value)},InputProps:{endAdornment:Object(p.jsx)(Je.a,{onClick:function(){""!==m&&(i.emit("message",m,t._id,c.id),y(""))},style:{cursor:"pointer"},fontSize:"small",color:"primary"})}})]})}),rt=function(){return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(tt,{}),Object(p.jsx)(nt,{})]})},ct=function(){var e=Object(h.useMediaQuery)({minWidth:800});return Object(p.jsx)(O,{children:Object(p.jsx)(Ee,{children:Object(p.jsxs)(Pe,{children:[e?Object(p.jsx)(et,{}):Object(p.jsx)(rt,{}),Object(p.jsx)(Me,{})]})})})},at=n(142),st=n.n(at),it=n(123),ot=n.n(it),lt=n(124),ut=n.n(lt),dt=n(201),jt=n.n(dt),bt=n(200),pt=n.n(bt),Ot=Object(r.createContext)(),ft=function(e){var t=e.children,n=Object(r.useContext)(S).user,c=Object(r.useState)(!1),a=Object(g.a)(c,2),s=a[0],i=a[1],o=Object(r.useState)(null),l=Object(g.a)(o,2),u=l[0],d=l[1],j=Object(r.useRef)();return Object(r.useEffect)((function(){return j.current=C()(z),j.current.on("incomming call",(function(e){d(e)})),function(){return j.current.emit("disconnect")}}),[,]),Object(r.useEffect)((function(){n&&!s&&(j.current.emit("login",n),i(!0))}),[n]),Object(p.jsx)(Ot.Provider,{value:{socket:j,incommingCall:u,setIncommingCall:d},children:t})},ht=(n(318),function(e){var t=e.peer,n=Object(r.useRef)();return Object(r.useEffect)((function(){t.peer.on("stream",(function(e){n.current.srcObject=e}))}),[]),Object(p.jsxs)("div",{className:"peer-container",children:[Object(p.jsx)("span",{children:t.peer._id}),Object(p.jsx)("video",{playsInline:!0,autoPlay:!0,ref:n})]})}),vt=(n(319),function(){var e=Object(r.useContext)(Ot),t=e.socket,n=e.setIncommingCall,c=Object(r.useContext)(S).user,a=Object(r.useState)([]),s=Object(g.a)(a,2),i=s[0],o=s[1],u=Object(r.useState)(!0),d=Object(g.a)(u,2),j=d[0],b=d[1],O=Object(r.useState)(!0),f=Object(g.a)(O,2),h=f[0],v=f[1],m=Object(r.useRef)(),y=Object(r.useRef)([]),C=Object(l.g)().id;Object(r.useEffect)((function(){n(null),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){var n=e.getAudioTracks()[0];b(n),n.enabled=!1,m.current.srcObject=e,t.current.emit("join call",C,c),t.current.on("all users",(function(n){var r=[];n.forEach((function(n){var c=w(n.socketId,t.current.id,e,n.username);y.current.push({peerID:n.socketId,peer:c}),r.push({socketId:n.socketId,peer:c})})),o(r)})),t.current.on("user joined",(function(t){var n=k(t.signal,t.callerID,e,t.username);console.log("add peer - before set state peers",n),y.current.push({peerID:t.callerID,peer:n}),o((function(e){return[].concat(Object(x.a)(e),[{socketId:t.callerID,peer:n}])}))})),t.current.on("receiving returned signal",(function(e){var t=y.current.find((function(t){return t.peerID===e.id}));t&&t.peer.signal(e.signal)}))})).catch((function(e){return console.log(e)})),t.current.on("user left",(function(e){o((function(t){return t.filter((function(t){return t.socketId!==e}))}));var t=y.current.find((function(t){return t.peerID===e}));t&&t.peer.destroy();var n=y.current.filter((function(t){return t.peerID!==e}));y.current=n,setTimeout((function(){return console.log(y.current)}),2e3)}))}),[,]);var w=function(e,n,r,c){var a=new st.a({initiator:!0,trickle:!1,stream:r,username:c});return a.on("signal",(function(r){t.current.emit("sending signal",{userToSignal:e,callerID:n,signal:r,username:c})})),a},k=function(e,n,r,c){var a=new st.a({initiator:!1,trickle:!1,stream:r,username:c});return a.on("signal",(function(e){t.current.emit("returning signal",{signal:e,callerID:n})})),a.signal(e),a};return Object(p.jsxs)("div",{className:"video-container",children:[Object(p.jsx)("div",{className:"video-peers",children:i.length>0?i.map((function(e){return Object(p.jsx)(ht,{peer:e},e.peer._id)})):Object(p.jsx)("span",{children:"You are alone ;_;"})}),Object(p.jsxs)("div",{className:"video-bar",children:[Object(p.jsx)("video",{ref:m,autoPlay:!0,playsInline:!0,className:"user-video"}),Object(p.jsxs)("div",{onClick:function(){t.current.emit("leave call",c.id),window.close()},children:[Object(p.jsx)(ot.a,{}),Object(p.jsx)("span",{children:"End call"})]}),Object(p.jsxs)("div",{onClick:function(){return t.current.emit("call users",C,c.id)},children:[Object(p.jsx)(ut.a,{}),Object(p.jsx)("span",{children:"Call all users"})]}),Object(p.jsxs)("div",{onClick:function(){j.enabled=!j.enabled,v(!j.enabled)},children:[h?Object(p.jsx)(pt.a,{}):Object(p.jsx)(jt.a,{}),Object(p.jsxs)("span",{children:["Microphone ",h?"off":"on"]})]})]})]})}),mt=n(203),xt=n(331),gt=(n(320),function(){return Object(p.jsx)("div",{className:"spinner-container",children:Object(p.jsx)(xt.a,{})})}),yt=function(e){var t=e.component,n=Object(mt.a)(e,["component"]),c=Object(r.useContext)(S).user;return function(){var e=Object(l.f)(),t=Object(r.useContext)(S),n=t.user,c=t.setUser,a=function(){var t=Object(L.a)(G.a.mark((function t(){var n,r,a;return G.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Z("/checkRole","GET");case 3:n=t.sent,r=n.status,a=n.data,200===r&&a.username&&a.role?(c(a),ke.set("user",JSON.stringify(a),{expires:7})):(c(null),e.push("/login")),t.next=13;break;case 8:t.prev=8,t.t0=t.catch(0),console.error(t.t0),c(null),e.push("/login");case 13:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}();Object(r.useEffect)((function(){setTimeout((function(){if(!n){var e=ke.get("user");if(e){var t=JSON.parse(e);console.log(t),t?c(t):a()}else a()}}),1e3)}),[,])}(),c?Object(p.jsx)(l.a,Object(D.a)(Object(D.a)({},n),{},{render:function(e){return Object(p.jsx)(t,Object(D.a)({},e))}})):Object(p.jsx)(gt,{})},Ct=function(){var e=Object(r.useContext)(Ot),t=e.incommingCall,n=e.setIncommingCall;return Object(p.jsxs)(N.a,{open:!!t,onClose:function(){return n(null)},fullWidth:!0,children:[Object(p.jsxs)(T.a,{id:"form-dialog-title",children:["Incomming call from group ",null===t||void 0===t?void 0:t.name]}),Object(p.jsxs)(E.a,{children:[Object(p.jsx)(_.a,{target:"_blank",href:"/VideoCall/".concat(null===t||void 0===t?void 0:t._id),onClick:function(){return setTimeout((function(){n(null)}),1e3)},color:"primary",children:Object(p.jsx)(ut.a,{})}),Object(p.jsx)(_.a,{color:"primary",onClick:function(){return n(null)},children:Object(p.jsx)(ot.a,{})})]})]})},St=(n(321),n(322),function(){var e,t=Object(r.useContext)(S).theme,n=(e=t,Object(u.a)({palette:{type:e},overrides:{MuiList:{root:{listStyle:"none"}}}}));return Object(p.jsxs)(o.a,{theme:n,children:[Object(p.jsx)(s.a,{}),Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(Ct,{}),Object(p.jsxs)(l.c,{children:[Object(p.jsx)(yt,{exact:!0,path:"/",component:f}),Object(p.jsx)(yt,{path:"/groups",component:ct}),Object(p.jsx)(yt,{path:"/videoCall/:id",component:vt}),Object(p.jsx)(yt,{path:"/calendar",component:ue}),Object(p.jsx)(yt,{path:"/files",component:pe}),Object(p.jsx)(yt,{path:"/account",component:we}),Object(p.jsx)(l.a,{path:"/logout",component:Te}),Object(p.jsx)(l.a,{path:"/login",component:Ne})]}),Object(p.jsx)(i.a,{position:"bottom-right",autoClose:7e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0})]})]})}),wt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function kt(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Nt=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,387)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))};a.a.render(Object(p.jsx)(w,{children:Object(p.jsx)(ft,{children:Object(p.jsx)(b.a,{children:Object(p.jsx)(St,{})})})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/remoTalky.client",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/remoTalky.client","/service-worker.js");wt?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):kt(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):kt(t,e)}))}}(),Nt()}},[[323,1,2]]]);
//# sourceMappingURL=main.63d0650b.chunk.js.map